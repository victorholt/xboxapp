var app=app||{};app.props=app.props||{},app.api=app.api||{},app.cache=app.cache||{},function(){"use strict";app.api={apiUrl:"http://js.november.sierrabravo.net/challenge/",apiKey:"a29238323ada61ccae7dece63fd9f51d",checkKey:function(a){app.props.serviceWorker&&!_.isUndefined(app.props.serviceWorker)?this.ajaxWorkerCall("checkKey",{},a):this.ajaxCall("checkKey",{},a)},getGames:function(a){this.checkKey(function(b){b===!0?app.props.serviceWorker&&!_.isUndefined(app.props.serviceWorker)?app.api.ajaxWorkerCall("getGames",{},a):app.api.ajaxCall("getGames",{},a):a&&!_.isUndefined(a)&&a(!1)})},addVote:function(a,b){return app.utils.canVote(app.cache.lastVotedTime)?void this.checkKey(function(c){c===!0?app.props.serviceWorker&&!_.isUndefined(app.props.serviceWorker)?app.api.ajaxWorkerCall("addVote",{id:a},function(a){a===!0&&(app.cache.lastVotedTime=Date.now()),b(a)}):app.api.ajaxCall("addVote",{id:a},function(a){a===!0&&(app.cache.lastVotedTime=Date.now()),b(a)}):b&&!_.isUndefined(b)&&b(!1)}):b(!1)},addGame:function(a,b){app.props.serviceWorker&&!_.isUndefined(app.props.serviceWorker)?this.checkKey(function(c){c===!0?app.api.ajaxWorkerCall("addGame",{title:a},function(a){a===!0&&(app.cache.lastVotedTime=Date.now()),b(a)}):b&&!_.isUndefined(b)&&b(!1)}):app.utils.isValidGameEntry(app.cache.games,a)&&app.utils.canVote(app.cache.lastVotedTime)?this.checkKey(function(c){c===!0?app.api.ajaxCall("addGame",{title:a},function(a){a===!0&&(app.cache.lastVotedTime=Date.now()),b(a)}):b&&!_.isUndefined(b)&&b(!1)}):b(!1)},setGotIt:function(a,b){this.checkKey(function(c){c===!0?app.props.serviceWorker&&!_.isUndefined(app.props.serviceWorker)?app.api.ajaxWorkerCall("setGotIt",{id:a},function(a){b(a)}):app.api.ajaxCall("setGotIt",{id:a},function(a){b(a)}):b&&!_.isUndefined(b)&&b(!1)})},clearGames:function(a){this.checkKey(function(b){b===!0?app.props.serviceWorker&&!_.isUndefined(app.props.serviceWorker)?app.api.ajaxWorkerCall("clearGames",{},function(b){b===!0&&(app.cache={}),a(b)}):app.api.ajaxCall("clearGames",{},function(b){b===!0&&(app.cache={}),a(b)}):a&&!_.isUndefined(a)&&a(!1)})},findGame:function(a,b){a=_.escape(a).trim(),this.getGames(function(c){if(c&&!_.isEmpty(c)){var d=_.find(c,function(b){return b.title.toLowerCase()==a.toLowerCase()?b:void 0});b(d)}else b(!1)})},ajaxCall:function(a,b,c){if(_.isUndefined(b)||!_.isObject(b))return c(!1);_.isUndefined(b.apiKey)&&(b.apiKey=this.apiKey);var d=$.ajax({url:this.apiUrl+a,jsonp:"callback",dataType:"jsonp",data:b});d.done(function(a){c&&!_.isUndefined(c)&&c(a)})},ajaxWorkerCall:function(a,b,c){app.props.serviceWorker.onmessage=function(a){c&&!_.isUndefined(c)&&c(a.data)};var d=this.apiUrl+a+"?callback=handleRequest&apiKey="+this.apiKey;b&&!_.isUndefined(b)&&_.isObject(b)&&!_.isEmpty(b)&&_.each(b,function(a,b){d+="&"+b+"="+a}),app.props.serviceWorker.postMessage({request:a,apiUrl:d,lastVotedTime:app.cache.lastVotedTime,games:app.cache.games,params:b})}}}();var app=app||{};app.common=app.common||{},function(){"use strict";app.common.ERROR_APPTITLE="<h2>Application Error</h2>",app.common.ERROR_APPTEXT="<p>Sorry, there seems to be an error with our application!</p>",app.common.ERROR_SUBMITTITLE="<h2>Invalid Game</h2>",app.common.ERROR_SUBMITTEXT="<p>Sorry, there was an error with your submission.</p><p>Please check to ensure your game title is not a duplicate and formatted correctly. Thanks!</p>",app.common.ERROR_CANADDGAMETITLE="<h2>Already voted or added a game</h2>",app.common.ERROR_CANADDGAMETEXT="<p>Sorry, you've either voted or added a game today. You will however be able to vote/add a game tomorrow!</p><p>Also note that you will not be able to vote/add a game on Saturday or Sunday.</p>",app.common.ERROR_VOTETITLE="<h2>Voting Error</h2>",app.common.ERROR_VOTETEXT="<p>Sorry, you've either already submitted a game or voted for today.</p>",app.common.ERROR_VOTE2TITLE="<h2>Voting Closed</h2>",app.common.ERROR_VOTE2TEXT="<p>Sorry, voting is closed today.</p>",app.common.dialogAnimationDelay=300,app.common.scrollToTop=function(a){(!a||_.isUndefined(a))&&(a=200),$("html, body").animate({scrollTop:0},a,"linear")},app.common.startAjaxLoader=function(){React.renderComponent(new AjaxLoader,$("#ajax-loader")[0])},app.common.endAjaxLoader=function(){React.unmountComponentAtNode($("#ajax-loader")[0])},app.common.openDialogBox=function(a,b){function c(){var a=$(document).width()/2-$("#dlg-box-content-container").width()/2-20;$("#dlg-box-content-container").css("left",a),$("#dlg-box-content-container").css("top","8%")}a&&a.preventDefault(),app.common.scrollToTop(0),$(window).resize(c),$(document).keyup(function(a){27==a.keyCode&&"visible"==$("#dlg-box-container").attr("data-state")&&app.common.closeDialogBox()}),$("#dlg-box").show(10,function(){$("#dlg-box-container").attr("data-state","visible"),c(),$("#dlg-box-container #dlg-box-content-container").css("top","5%"),$("#dlg-box-container #dlg-box-content-container").animate({opacity:1,top:"8%"},app.common.dialogAnimationDelay,function(){b&&b()})})},app.common.closeDialogBox=function(a,b){a&&a.preventDefault();var c=$("#dlg-box-container");c&&!_.isUndefined(c)&&$(c).is(":visible")&&($("#dlg-box-container").attr("data-state","hidden"),$("#dlg-box-container #dlg-box-content-container").animate({opacity:0,marginTop:"-3%"},app.common.dialogAnimationDelay,"swing",function(){$("#dlg-box").fadeOut(app.common.dialogAnimationDelay,function(){React.unmountComponentAtNode($("#dlg-box")[0]),b&&b()})}))}}();var app=app||{};app.utils=app.utils||{},function(){"use strict";app.utils.isValidGameEntry=function(a,b){if(a&&!_.isUndefined(a)&&_.isObject(a)){b=_.escape(b).trim();var c=_.find(a,function(a){return a.title.toLowerCase()==b.toLowerCase()?!0:void 0});if(""!==b&&!c)return!0}return!1},app.utils.canVote=function(a){(!a||_.isUndefined(a))&&(a=0);var b=new Date,c=b.getFullYear()+"-"+b.getMonth()+"-"+b.getDate(),d=0!==a?new Date(a):new Date(1970,1,1),e=d.getFullYear()+"-"+d.getMonth()+"-"+d.getDate();return c==e?!1:0===b.getDay()||6===b.getDay()?!1:!0}}();var app=app||{};app.props=app.props||{};var CanvasLoader=React.createClass({displayName:"CanvasLoader",handleLoop:function(){requestAnimFrame(this.handleLoop,app.props.ajaxLoaderCanvas),app.props.ajaxLoaderCanvasCtx.globalCompositeOperation="destination-out",app.props.ajaxLoaderCanvasCtx.fillStyle="rgba(255,255,255,.03)",app.props.ajaxLoaderCanvasCtx.fillRect(0,0,250,250),this.updateCanvasLoader(),this.renderCanvasLoader()},updateCanvasLoader:function(){app.props.ajaxLoaderRotation+=app.props.ajaxLoaderSpeed/100},renderCanvasLoader:function(){app.props.ajaxLoaderCanvasCtx.save(),app.props.ajaxLoaderCanvasCtx.globalCompositeOperation="source-over",app.props.ajaxLoaderCanvasCtx.translate(35,35),app.props.ajaxLoaderCanvasCtx.rotate(app.props.ajaxLoaderRotation);for(var a=app.props.ajaxLoaderCount;a--;)app.props.ajaxLoaderCanvasCtx.beginPath(),app.props.ajaxLoaderCanvasCtx.arc(0,0,20,Math.random(),1,!1),app.props.ajaxLoaderCanvasCtx.arc(0,0,18,Math.random(),1,!1),app.props.ajaxLoaderCanvasCtx.fill();app.props.ajaxLoaderCanvasCtx.restore()},componentDidMount:function(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var a=$("#ajax-loader-canvas")[0];app.props.ajaxLoaderCanvasCtx=a.getContext("2d"),app.props.ajaxLoaderCanvasCtx.lineWidth=2,app.props.ajaxLoaderCanvasCtx.strokeStyle="rgba(255,255,255,.75)",app.props.ajaxLoaderCount=128,app.props.ajaxLoaderRotation=128*(Math.PI/180),app.props.ajaxLoaderSpeed=12,app.props.ajaxLoaderCanvas=a,this.handleLoop()},render:function(){return React.DOM.div({className:"ajax-loader-container"},React.DOM.canvas({id:"ajax-loader-canvas",width:"70",height:"70"}))}}),AjaxLoader=React.createClass({displayName:"AjaxLoader",render:function(){return CanvasLoader(null)}}),app=app||{};app.props=app.props||{};var BackgroundSlider=React.createClass({displayName:"BackgroundSlider",handleLoop:function(){setInterval(function(){!_.isUndefined(app.props.backgroundImages)&&!_.isEmpty(app.props.backgroundImages)&&app.props.backgroundImages.length>1&&window.innerWidth>1e3&&(app.props.backgroundImageDelta>app.props.backgroundImageTimeout?(app.props.backgroundImageDelta=0,app.props.backgroundImageLocked=!0,app.props.backgroundImageCurrentIndex++,app.props.backgroundImageCurrentIndex>=app.props.backgroundImages.length&&(app.props.backgroundImageCurrentIndex=0),$("#background-slider-next").css("background-image","url("+app.props.backgroundImages[app.props.backgroundImageCurrentIndex].src+")"),$("#background-slider-next").fadeIn(300,function(){$("#background-slider").css("background-image","url("+app.props.backgroundImages[app.props.backgroundImageCurrentIndex].src+")"),setTimeout(function(){$("#background-slider-next").hide(),app.props.backgroundImageLocked=!1},500)})):app.props.backgroundImageLocked||app.props.backgroundImageDelta++)},1e3)},componentDidMount:function(){app.props.backgroundImages=[],app.props.backgroundImageDelta=0,app.props.backgroundImageCurrentIndex=0,app.props.backgroundImageLocked=!1;for(var a=["cityscape-bladeruner.jpg","cloudy-peaks-final.jpg","exterior-jungle-Final-2.jpg","helius-final.jpg","jungles-of-eknazaar.jpg"],b=0;b<a.length;b++){var c=new Image;c.onload=function(){_.isEmpty(app.props.backgroundImages)&&$("#background-slider").css("background-image","url("+this.src+")"),app.props.backgroundImages.push(this)},c.src="/images/"+a[b]}this.handleLoop()},render:function(){return app.props.backgroundImageTimeout=_.isUndefined(this.props.imageTimeout)?5:parseInt(this.props.imageTimeout),React.DOM.div({id:"background-slider"},React.DOM.div({id:"background-slider-next"}),React.DOM.div({id:"background-slider-overlay"}))}}),app=app||{},DialogBox=React.createClass({displayName:"DialogBox",componentDidMount:function(){app.common.openDialogBox(),this.props.onOpen&&_.isFunction(this.props.onOpen)&&this.props.onOpen(this)},componentWillUnmount:function(){this.props.onClose&&_.isFunction(this.props.onClose)&&this.props.onClose(this)},handleClose:function(){app.common.closeDialogBox()},render:function(){var a="dlg-box-default";return this.props.className&&(a=this.props.className),a="dlg-box "+a,React.DOM.div({"data-state":"hidden",id:"dlg-box-container",className:a},React.DOM.div({className:"dlg-box-bg"}),React.DOM.div({id:"dlg-box-content-container"},React.DOM.div({className:"dlg-box-close"},React.DOM.span({className:"icon-cancel",onClick:this.handleClose})),React.DOM.div({className:"dlg-box-header",dangerouslySetInnerHTML:{__html:this.props.headerHTML}}),React.DOM.div({className:"dlg-box-content",dangerouslySetInnerHTML:{__html:this.props.children}}),React.DOM.div({className:"dlg-box-footer"},React.DOM.button({className:"dlg-box-close-btn",onClick:this.handleClose},"Close"))))}}),app=app||{},GameApplication=React.createClass({displayName:"GameApplication",render:function(){return React.DOM.div(null,React.DOM.div({id:"ajax-loader"}),React.DOM.div({id:"dlg-box"}),BackgroundSlider({imageTimeout:"10"}),Navigation(null),React.DOM.div({id:"application-page"}),React.DOM.div({className:"min-height"}))}}),app=app||{};app.cache=app.cache||{},app.cache.games=app.cache.games||[];var GameOwnedPage=React.createClass({displayName:"GameOwnedPage",displayGameItem:function(a){return!a||_.isUndefined(a)?!1:React.DOM.li({id:"game-entry-"+a.id,className:"gotit"!==a.status?" hidden":""},React.DOM.div({className:"hover-overlay"}),React.DOM.div({className:"left"},React.DOM.span({id:"game-votes-"+a.id,className:"votes"},a.votes),_.unescape(a.title)),React.DOM.div({className:"clear"}))},getInitialState:function(){return{games:[]}},componentDidMount:function(){var a=this;app.cache.games&&!_.isUndefined(app.cache.games)&&this.setState({games:app.cache.games}),app.cache.dirty=!1,setInterval(function(){app.cache.dirty&&(app.cache.games=_.sortBy(app.cache.games,function(a){return a.title}),a.setState({games:app.cache.games}),app.cache.dirty=!1)},200),app.common.startAjaxLoader(),app.api.getGames(function(a){a?(app.cache.games=a,app.cache.dirty=!0,app.common.endAjaxLoader()):(app.common.endAjaxLoader(),React.renderComponent(DialogBox({headerHTML:app.common.ERROR_APPTITLE},app.common.ERROR_APPTEXT),$("#dlg-box")[0]))})},render:function(){return React.DOM.div({className:"container"},React.DOM.div({className:"row"},React.DOM.div({className:"span12"},React.DOM.div({className:"game-container"},React.DOM.div({className:"game-container-bg"}),React.DOM.div({className:"game-content left"},React.DOM.h2(null,"Games you already own!")),React.DOM.div({className:"clear"}),React.DOM.div({className:"game-content"},React.DOM.ul(null,this.state.games.map(this.displayGameItem)))))))}}),app=app||{};app.cache=app.cache||{},app.cache.games=app.cache.games||[];var GameVoteButton=React.createClass({displayName:"GameVoteButton",handleClick:function(a){a.preventDefault();var b=this;this.props.gameId&&!_.isUndefined(this.props.gameId)?(app.common.startAjaxLoader(),app.api.addVote(this.props.gameId,function(a){if(a){var c=parseInt($("span#game-votes-"+b.props.gameId).html()),d=_.findWhere(app.cache.games,{id:b.props.gameId});d.votes=++c,app.cache.dirty=!0,app.common.endAjaxLoader()}else app.common.endAjaxLoader(),React.renderComponent(DialogBox({headerHTML:app.common.ERROR_VOTETITLE},app.common.ERROR_VOTETEXT),$("#dlg-box")[0])})):(app.common.endAjaxLoader(),React.renderComponent(DialogBox({headerHTML:app.common.ERROR_APPTITLE},app.common.ERROR_APPTEXT),$("#dlg-box")[0]))},render:function(){return React.DOM.button({onClick:this.handleClick},"Vote")}}),GameOwnButton=React.createClass({displayName:"GameOwnButton",handleClick:function(a){a.preventDefault(),app.common.startAjaxLoader();this.props.gameId&&!_.isUndefined(this.props.gameId)&&app.api.setGotIt(this.props.gameId,function(a){a?(app.api.getGames(function(a){a&&(app.cache.games=a,app.cache.dirty=!0)}),app.common.endAjaxLoader()):(app.common.endAjaxLoader(),React.renderComponent(DialogBox({headerHTML:app.common.ERROR_APPTITLE},app.common.ERROR_APPTEXT),$("#dlg-box")[0]))})},render:function(){return React.DOM.button({onClick:this.handleClick},"Own")}}),GameVotingPage=React.createClass({displayName:"GameVotingPage",handleSubmit:function(a){a.preventDefault();var b=this,c=$("#gameTitle").val();app.common.startAjaxLoader(),app.api.addGame(c,function(a){a?(app.api.findGame(c,function(a){app.cache.games.push(a),b.setState({games:app.cache.games})}),app.common.endAjaxLoader()):(app.common.endAjaxLoader(),app.utils.canVote(app.cache.lastVotedTime)?React.renderComponent(DialogBox({headerHTML:app.common.ERROR_SUBMITTITLE},app.common.ERROR_SUBMITTEXT),$("#dlg-box")[0]):React.renderComponent(DialogBox({headerHTML:app.common.ERROR_CANADDGAMETITLE},app.common.ERROR_CANADDGAMETEXT),$("#dlg-box")[0]))}),document.GameForm.reset()},handleGameVote:function(a){a.preventDefault(),app.common.startAjaxLoader(),app.api.addVote(function(a){a&&app.common.endAjaxLoader()})},handleOwnGame:function(a){a.preventDefault(),app.common.startAjaxLoader()},displayGameItem:function(a){return!a||_.isUndefined(a)?!1:React.DOM.li({id:"game-entry-"+a.id,className:"gotit"===a.status?" hidden":""},React.DOM.div({className:"hover-overlay"}),React.DOM.div({className:"left"},React.DOM.span({id:"game-votes-"+a.id,className:"votes"},a.votes),_.unescape(a.title)),React.DOM.div({className:"right"},GameVoteButton({gameId:a.id}),GameOwnButton({gameId:a.id})),React.DOM.div({className:"clear"}))},getInitialState:function(){return{games:[]}},componentDidMount:function(){var a=this;app.cache.games&&!_.isUndefined(app.cache.games)&&this.setState({games:app.cache.games}),app.cache.dirty=!1,setInterval(function(){app.cache.dirty&&(app.cache.games=_.sortBy(app.cache.games,function(a){return-a.votes}),a.setState({games:app.cache.games}),app.cache.dirty=!1)},200),app.common.startAjaxLoader(),app.api.getGames(function(a){a?(app.cache.games=a,app.cache.dirty=!0,app.common.endAjaxLoader()):(app.common.endAjaxLoader(),React.renderComponent(DialogBox({headerHTML:app.common.ERROR_APPTITLE},app.common.ERROR_APPTEXT),$("#dlg-box")[0]))})},render:function(){return React.DOM.div({className:"container"},React.DOM.div({className:"row"},React.DOM.div({className:"span12"},React.DOM.div({className:"game-container"},React.DOM.div({className:"game-container-bg"}),React.DOM.div({className:"game-content left"},React.DOM.h2(null,"Vote for your favorite games!")),React.DOM.div({className:"game-form right"},React.DOM.form({id:"GameForm",name:"GameForm",onSubmit:this.handleSubmit},React.DOM.input({type:"text",id:"gameTitle",name:"gameTitle",placeholder:"Add new game"}),React.DOM.button({onClick:this.handleSubmit},"Add Game"))),React.DOM.div({className:"clear"}),React.DOM.div({className:"game-content"},React.DOM.ul(null,this.state.games.map(this.displayGameItem)))))))}}),app=app||{};Navigation=React.createClass({displayName:"Navigation",clearGames:function(a){a.preventDefault(),app.common.startAjaxLoader(),app.api.clearGames(function(){app.cache.dirty=!0,app.common.endAjaxLoader()})},showNavigation:function(){$("ul#navlinks").toggle(),console.log("showing navigation")},render:function(){return React.DOM.div({className:"container-fluid"},React.DOM.div({className:"row"},React.DOM.div({className:"span12"},React.DOM.div({id:"navigation"},React.DOM.div({className:"span6"},React.DOM.ul({className:"left"},React.DOM.li(null,React.DOM.span({className:"nav-title"},"XBOX Games")))),React.DOM.div({className:"span6"},React.DOM.div({className:"menubars",onClick:this.showNavigation},React.DOM.ul({id:"menubars",className:"right hidden-desktop"},React.DOM.li(null,React.DOM.span({className:"navbar1"}),React.DOM.span({className:"navbar2"}),React.DOM.span({className:"navbar3"})))),React.DOM.ul({id:"navlinks",className:"right visible-desktop"},React.DOM.li(null,React.DOM.a({href:"/"},"Home"),React.DOM.a({href:"/owned-games"},"Owned Games"),React.DOM.a({href:"javascript: void(0);",onClick:this.clearGames},"Clear Games")))),React.DOM.div({className:"clear"})))))}});var app=app||{};app.props=app.props||{},app.utils=app.utils||{},app.common=app.common||{},app.loadedComponent=null,function(){app.AppRouter=Backbone.Router.extend({routes:{"":"indexAction","owned-games":"gamesOwnedAction","*path":"error404Action"},initialize:function(){window.Worker&&!_.isUndefined(window.Worker)&&(app.props.serviceWorker=new Worker("/js/serviceWorker.js")),localStorage&&!_.isUndefined(localStorage)&&(localStorage.appData&&!_.isUndefined(localStorage.appData)&&(app.cache=JSON.parse(localStorage.appData)),setInterval(function(){localStorage.setItem("appData",JSON.stringify(app.cache))},500)),Backbone.history.start({pushState:!0})},indexAction:function(){app.loadedComponent&&(React.unmountComponentAtNode($("#application-page")[0]),app.loadedComponent=null),app.loadedComponent=React.renderComponent(new GameVotingPage,$("#application-page")[0])},gamesOwnedAction:function(){app.loadedComponent&&(React.unmountComponentAtNode($("#application-page")[0]),app.loadedComponent=null),app.loadedComponent=React.renderComponent(new GameOwnedPage,$("#application-page")[0])},error404Action:function(){console.log("page not found")}}),$(document).on("click","a[href^='/']",function(a){for(var b=$(a.currentTarget).attr("href"),c=[/\/login/],d=0,e=0;e<c.length;e++)if(c[e].test(b)){d=1;break}if(!(d||a.altKey||a.ctrlKey||a.metaKey||a.shiftKey)){a.preventDefault();var f=b.replace(/^\//,"").replace("#!/","");return app.router.navigate(f,{trigger:!0}),!1}return window.location=b,!0})}();